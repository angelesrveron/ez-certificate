

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/thomas-lowry/figma-plugin-ds/dist/figma-plugin-ds.css">

  <link rel="icon" href="assets/logo.png" type="image/png" />

<style>
  body {
    padding: 2em;
    max-width: 400px;
    margin: 0 auto;
  }

  input {
    width: 100%;
    margin-bottom: 1em;
  }
</style>

<h2>Generador masivo de certificados</h2>

<label for="sheetLink">URL del Google Sheets (público)</label>
<input type="text" id="sheetLink" placeholder="Pega aquí tu link">

<label for="sheetName">Nombre de la hoja</label>
<input type="text" id="sheetName" placeholder="Por ejemplo: Estudiantes">

<button class="button button--primary" id="generarBtn">Generar certificados</button>

<button class="button button--secondary" id="mostrarGuia" style="margin-top: 1em;">
  INFO
</button>

<div id="guiaModal" style="display:none; position:fixed; top:5%; left:50%; transform:translateX(-50%);
  background:white; border:1px solid #ccc; border-radius:8px; padding:1em; width:80%; max-width:400px;
  box-shadow: 0 0 20px rgba(0,0,0,0.2); z-index:9999; ">
  <strong>📝 ¿Cómo vincular tu diseño?</strong>
  <ul style="font-size: 14px;">
    <li>La primera fila del Sheet debe tener los nombres de los campos, por ejemplo: <code>NOMBRE</code>, <code>CURSO</code>, <code>FECHA</code>.</li>
    <li>En Figma, nombra tus <strong>capas de texto</strong> con el mismo nombre pero precedido de un <code>#</code>, por ejemplo: <code>#NOMBRE</code>.</li>
  
    <li>El plugin reemplazará automáticamente esos textos con los datos del Sheet.</li>
    <li style="color: red">También recordá no usar "ñ" tanto en tu Sheet como en Figma</li>

  </ul>
  <button class="button button--secondary" id="cerrarGuia" style="margin-top:1em;">Cerrar</button>
</div>

<script>
  document.getElementById("generarBtn").onclick = () => {
    const link = document.getElementById("sheetLink").value.trim();
    const sheetName = document.getElementById("sheetName").value.trim();

    // Extraer ID de Sheet
    const match = link.match(/\/d\/([a-zA-Z0-9-_]+)/);

    if (!match || !sheetName) {
      alert("Verifica que el link y el nombre de la hoja sean correctos.");
      return;
    }

    const sheetId = match[1];

    parent.postMessage({ pluginMessage: { sheetId, sheetName } }, "*");
  };

  document.getElementById("mostrarGuia").onclick = () => {
    document.getElementById("guiaModal").style.display = "block";
  };
  document.getElementById("cerrarGuia").onclick = () => {
    document.getElementById("guiaModal").style.display = "none";
  };
</script>
